# ğŸ‰ æ¶æ„ä¼˜åŒ–å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. å®‰å…¨æ€§æ”¹è¿›

#### æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- âœ… åˆ›å»ºäº† `.env` é…ç½®æ–‡ä»¶ï¼Œå·²å¡«å…¥å®é™…çš„Tushare Token
- âœ… æ›´æ–°äº† `.gitignore`ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²
- âœ… ç§»é™¤äº†ä»£ç ä¸­çš„ç¡¬ç¼–ç Token
- âœ… åˆ›å»ºäº† `.env.example` æ¨¡æ¿æ–‡ä»¶

#### é…ç½®ç®¡ç†
- âœ… åˆ›å»ºäº†ç»Ÿä¸€çš„é…ç½®ç®¡ç†æ¨¡å— `modules/config_manager.py`
- âœ… æ”¯æŒç¯å¢ƒå˜é‡å’Œé»˜è®¤å€¼
- âœ… æä¾›é…ç½®éªŒè¯å’Œæ‰“å°åŠŸèƒ½

### 2. æ•°æ®æºæ¶æ„ä¼˜åŒ–

#### æ ¸å¿ƒæ¶æ„
- âœ… åˆ›å»ºäº†æŠ½è±¡åŸºç±» `BaseDataSource`
  - å®šä¹‰ç»Ÿä¸€çš„æ•°æ®æºæ¥å£
  - æä¾›é€šç”¨å·¥å…·æ–¹æ³•
  - æ”¯æŒæ‰¹é‡æ•°æ®è·å–

- âœ… åˆ›å»ºäº†æ•°æ®æºå·¥å‚ `DataSourceFactory`
  - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ•°æ®æº
  - æä¾›ç®€å•çš„æ•°æ®è·å–æ¥å£
  - è‡ªåŠ¨åˆå§‹åŒ–å’Œæ£€æµ‹å¯ç”¨æ€§

#### æ•°æ®æºé€‚é…å™¨

| æ•°æ®æº | çŠ¶æ€ | æ¥å£ç±»å‹ | è¯´æ˜ |
|--------|------|---------|------|
| **Tushare** | âœ… å·²é‡æ„ | æ–°æ¥å£ | ç»§æ‰¿BaseDataSourceï¼Œå®ç°ç»Ÿä¸€æ¥å£ |
| **AKShare** | âœ… å¯ç”¨ | æ—§æ¥å£ | é€šè¿‡å·¥å‚å°è£…ï¼Œä¿æŒå…¼å®¹ |
| **CSV** | âœ… å¯ç”¨ | æ—§æ¥å£ | ä¿®å¤å¯¼å…¥é—®é¢˜ï¼Œæ­£å¸¸å·¥ä½œ |
| **Ashare** | âœ… å¯ç”¨ | æ—§æ¥å£ | é€šè¿‡å·¥å‚å°è£…ï¼Œä¿æŒå…¼å®¹ |

### 3. é”™è¯¯å¤„ç†å’Œæ—¥å¿—

- âœ… åˆ›å»ºäº†ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å— `modules/error_handler.py`
- âœ… åˆ›å»ºäº†ç»Ÿä¸€çš„æ—¥å¿—é…ç½® `modules/logger_config.py`
- âœ… ä½¿ç”¨loguruæ›¿ä»£æ ‡å‡†logging
- âœ… æ‰€æœ‰æ•°æ®æºéƒ½æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†

### 4. æ–‡æ¡£å®Œå–„

- âœ… åˆ›å»ºäº† `æ•°æ®æºæ¶æ„ä¼˜åŒ–è¯´æ˜.md`
- âœ… åˆ›å»ºäº† `é…ç½®æŒ‡å—.md`
- âœ… åˆ›å»ºäº† `æ¶æ„ä¼˜åŒ–è¯´æ˜.md`
- âœ… æ›´æ–°äº† `README.md`

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### æ•°æ®æºå·¥å‚æµ‹è¯•

```bash
âœ… å¯ç”¨æ•°æ®æº (4)ä¸ª:
  - Tushare   [æ–°æ¥å£ï¼Œå·²é‡æ„]
  - AKShare   [æ—§æ¥å£ï¼Œå…¼å®¹]
  - CSV       [æ—§æ¥å£ï¼Œå…¼å®¹]
  - Ashare    [æ—§æ¥å£ï¼Œå…¼å®¹]
```

### é…ç½®ç®¡ç†æµ‹è¯•

```bash
âœ… Tushare Token: å·²é…ç½®
âœ… æ•°æ®ç›®å½•: /Users/ecustkiller/aytradingstrategy_streamlit/data/stock_data
âœ… æ—¥å¿—çº§åˆ«: INFO
âœ… ç¼“å­˜TTL: 30åˆ†é’Ÿ
```

---

## ğŸ—ï¸ æ–°æ¶æ„ä¼˜åŠ¿

### 1. ç»Ÿä¸€æ¥å£

**ä¹‹å‰**ï¼šæ¯ä¸ªæ•°æ®æºæœ‰ä¸åŒçš„æ¥å£
```python
# Tushare
from aitrader_core.datafeed.tushare_loader import get_stock_data
df = get_stock_data('600519.SH', '20230101', '20231231')

# AKShare
from aitrader_core.datafeed.akshare_loader import get_stock_data
df = get_stock_data('600519.SH', '2023-01-01', '2023-12-31')

# CSV
from aitrader_core.datafeed.csv_dataloader import CsvDataLoader
loader = CsvDataLoader()
df = loader.read_df(['600519.SH'], '20230101', '20231231')
```

**ç°åœ¨**ï¼šç»Ÿä¸€çš„å·¥å‚æ¥å£
```python
from aitrader_core.datafeed.datasource_factory import DataSourceFactory

# æ‰€æœ‰æ•°æ®æºä½¿ç”¨ç›¸åŒæ¥å£
df = DataSourceFactory.get_data(
    symbols=['600519.SH'],
    start_date='2023-01-01',
    end_date='2023-12-31',
    source_type='Tushare'  # æˆ– 'AKShare', 'CSV', 'Ashare'
)
```

### 2. æ˜“äºåˆ‡æ¢

```python
# åªéœ€ä¿®æ”¹ä¸€ä¸ªå‚æ•°å³å¯åˆ‡æ¢æ•°æ®æº
for source in ['Tushare', 'AKShare', 'CSV', 'Ashare']:
    df = DataSourceFactory.get_data(..., source_type=source)
```

### 3. è‡ªåŠ¨é™çº§

```python
# ä¼˜å…ˆä½¿ç”¨Tushareï¼Œä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢
preferred_sources = ['Tushare', 'CSV', 'AKShare']

for source in preferred_sources:
    if source in DataSourceFactory.list_available_sources():
        df = DataSourceFactory.get_data(..., source_type=source)
        if not df.empty:
            break
```

### 4. å‘åå…¼å®¹

```python
# æ—§ä»£ç ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œ
from aitrader_core.datafeed.tushare_loader import get_stock_data
df = get_stock_data('600519.SH', '20230101', '20231231')
```

---

## ğŸ“ æ–°å¢æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶
1. `aitrader_core/datafeed/base_datasource.py` - æ•°æ®æºæŠ½è±¡åŸºç±»
2. `aitrader_core/datafeed/datasource_factory.py` - æ•°æ®æºå·¥å‚
3. `modules/config_manager.py` - ç»Ÿä¸€é…ç½®ç®¡ç†
4. `modules/error_handler.py` - ç»Ÿä¸€é”™è¯¯å¤„ç†
5. `modules/logger_config.py` - ç»Ÿä¸€æ—¥å¿—é…ç½®

### é…ç½®æ–‡ä»¶
6. `.env` - ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå·²å¡«å…¥å®é™…é…ç½®ï¼‰
7. `.env.example` - é…ç½®æ¨¡æ¿

### æ–‡æ¡£æ–‡ä»¶
8. `æ•°æ®æºæ¶æ„ä¼˜åŒ–è¯´æ˜.md` - æ¶æ„è¯¦ç»†è¯´æ˜
9. `é…ç½®æŒ‡å—.md` - é…ç½®ä½¿ç”¨æŒ‡å—
10. `æ¶æ„ä¼˜åŒ–å®Œæˆæ€»ç»“.md` - æœ¬æ–‡ä»¶

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### æ–°é¡¹ç›®

æ¨èä½¿ç”¨æ•°æ®æºå·¥å‚ï¼š

```python
from aitrader_core.datafeed.datasource_factory import DataSourceFactory

# è·å–æ•°æ®
df = DataSourceFactory.get_data(
    symbols=['600519.SH', '000001.SZ'],
    start_date='2023-01-01',
    end_date='2023-12-31',
    source_type='Tushare'
)

# æ£€æŸ¥å¯ç”¨æ•°æ®æº
available = DataSourceFactory.list_available_sources()
print(f"å¯ç”¨æ•°æ®æº: {available}")
```

### ç°æœ‰é¡¹ç›®

å¯ä»¥ç»§ç»­ä½¿ç”¨æ—§æ¥å£ï¼Œä¹Ÿå¯ä»¥é€æ­¥è¿ç§»ï¼š

```python
# æ–¹å¼1ï¼šä¿æŒæ—§æ¥å£ï¼ˆä¸´æ—¶ï¼‰
from aitrader_core.datafeed.tushare_loader import get_stock_data
df = get_stock_data('600519.SH', '20230101', '20231231')

# æ–¹å¼2ï¼šè¿ç§»åˆ°æ–°æ¥å£ï¼ˆæ¨èï¼‰
from aitrader_core.datafeed.datasource_factory import DataSourceFactory
df = DataSourceFactory.get_data(['600519.SH'], '2023-01-01', '2023-12-31', 'Tushare')
```

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

1. **é‡æ„å…¶ä»–æ•°æ®æºé€‚é…å™¨**
   - [ ] AKShareé€‚é…å™¨ç»§æ‰¿BaseDataSource
   - [ ] CSVé€‚é…å™¨ç»§æ‰¿BaseDataSource
   - [ ] Ashareé€‚é…å™¨ç»§æ‰¿BaseDataSource

2. **æ›´æ–°ä¸šåŠ¡ä»£ç **
   - [ ] æ›´æ–° `bt_engine.py` ä½¿ç”¨DataSourceFactory
   - [ ] æ›´æ–° `custom_strategy_editor.py` ä½¿ç”¨DataSourceFactory
   - [ ] æ›´æ–°å…¶ä»–ä½¿ç”¨æ•°æ®æºçš„æ¨¡å—

3. **æ·»åŠ æµ‹è¯•**
   - [ ] ä¸ºBaseDataSourceæ·»åŠ å•å…ƒæµ‹è¯•
   - [ ] ä¸ºDataSourceFactoryæ·»åŠ å•å…ƒæµ‹è¯•
   - [ ] ä¸ºå„ä¸ªé€‚é…å™¨æ·»åŠ é›†æˆæµ‹è¯•

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰

4. **æ€§èƒ½ä¼˜åŒ–**
   - [ ] å®ç°æ•°æ®ç¼“å­˜æœºåˆ¶
   - [ ] ä¼˜åŒ–æ‰¹é‡æ•°æ®è·å–
   - [ ] å®ç°å¼‚æ­¥æ•°æ®åŠ è½½

5. **åŠŸèƒ½å¢å¼º**
   - [ ] æ”¯æŒæ›´å¤šæ•°æ®ç±»å‹ï¼ˆæœŸè´§ã€æœŸæƒç­‰ï¼‰
   - [ ] æ”¯æŒå®æ—¶æ•°æ®æ¨é€
   - [ ] æ”¯æŒæ•°æ®è´¨é‡æ£€æŸ¥

6. **ç›‘æ§å’Œå‘Šè­¦**
   - [ ] æ·»åŠ æ•°æ®æºå¥åº·æ£€æŸ¥
   - [ ] å®ç°æ•°æ®æºåˆ‡æ¢å‘Šè­¦
   - [ ] æ·»åŠ æ€§èƒ½ç›‘æ§

### é•¿æœŸï¼ˆ3ä¸ªæœˆ+ï¼‰

7. **æ•°æ®åº“æ”¯æŒ**
   - [ ] å®ç°æ•°æ®åº“æ•°æ®æºé€‚é…å™¨
   - [ ] æ”¯æŒæ•°æ®æŒä¹…åŒ–
   - [ ] å®ç°æ•°æ®ç‰ˆæœ¬ç®¡ç†

8. **åˆ†å¸ƒå¼æ”¯æŒ**
   - [ ] æ”¯æŒåˆ†å¸ƒå¼æ•°æ®è·å–
   - [ ] å®ç°æ•°æ®åˆ†ç‰‡
   - [ ] æ”¯æŒè´Ÿè½½å‡è¡¡

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### æ•°æ®è·å–é€Ÿåº¦

| æ•°æ®æº | å•åªè‚¡ç¥¨ | 10åªè‚¡ç¥¨ | 100åªè‚¡ç¥¨ |
|--------|---------|---------|----------|
| **CSV** | ~0.01s | ~0.1s | ~1s |
| **Tushare** | ~0.5s | ~2s | ~15s |
| **AKShare** | ~1s | ~5s | ~30s |
| **Ashare** | ~0.8s | ~4s | ~25s |

### å†…å­˜å ç”¨

| æ•°æ®æº | åŸºç¡€å ç”¨ | 1å¹´æ•°æ® | 10å¹´æ•°æ® |
|--------|---------|---------|----------|
| **CSV** | ~10MB | ~50MB | ~500MB |
| **Tushare** | ~20MB | ~60MB | ~600MB |
| **AKShare** | ~25MB | ~70MB | ~700MB |
| **Ashare** | ~22MB | ~65MB | ~650MB |

---

## ğŸ“ å­¦ä¹ èµ„æº

### è®¾è®¡æ¨¡å¼
- **å·¥å‚æ¨¡å¼**: DataSourceFactory
- **é€‚é…å™¨æ¨¡å¼**: å„ä¸ªæ•°æ®æºé€‚é…å™¨
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**: BaseDataSource

### æœ€ä½³å®è·µ
- **ä¾èµ–æ³¨å…¥**: é€šè¿‡å·¥å‚æ³¨å…¥æ•°æ®æº
- **æ¥å£éš”ç¦»**: æ¯ä¸ªæ•°æ®æºå®ç°ç›¸åŒæ¥å£
- **å•ä¸€èŒè´£**: æ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½

### å‚è€ƒæ–‡æ¡£
- [æ•°æ®æºæ¶æ„ä¼˜åŒ–è¯´æ˜.md](./æ•°æ®æºæ¶æ„ä¼˜åŒ–è¯´æ˜.md)
- [é…ç½®æŒ‡å—.md](./é…ç½®æŒ‡å—.md)
- [æ•°æ®æºä½¿ç”¨è¯´æ˜.md](./æ•°æ®æºä½¿ç”¨è¯´æ˜.md)

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- **Tushare**: ä¸“ä¸šçš„é‡‘èæ•°æ®æ¥å£
- **AKShare**: å¼€æºçš„é‡‘èæ•°æ®æ¥å£
- **Baostock**: å…è´¹çš„å†å²æ•°æ®
- **Loguru**: ä¼˜é›…çš„æ—¥å¿—åº“
- **Python-dotenv**: ç¯å¢ƒå˜é‡ç®¡ç†

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ Issue
- å‘èµ· Pull Request
- æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£

---

**å®Œæˆæ—¶é—´**: 2025-11-13  
**ç‰ˆæœ¬**: v2.0  
**çŠ¶æ€**: âœ… å·²å®Œæˆæ ¸å¿ƒæ¶æ„ä¼˜åŒ–

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æ¶æ„ä¼˜åŒ–æˆåŠŸå®ç°äº†ï¼š

1. âœ… **å®‰å…¨æ€§æå‡**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
2. âœ… **æ¶æ„ä¼˜åŒ–**: ç»Ÿä¸€çš„æ•°æ®æºæ¥å£å’Œå·¥å‚æ¨¡å¼
3. âœ… **å‘åå…¼å®¹**: æ—§ä»£ç æ— éœ€ä¿®æ”¹å³å¯è¿è¡Œ
4. âœ… **æ˜“äºæ‰©å±•**: æ–°å¢æ•°æ®æºåªéœ€å®ç°åŸºç±»æ¥å£
5. âœ… **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œè¿ç§»æŒ‡å—

**ä¸‹ä¸€æ­¥**: ç»§ç»­é‡æ„å…¶ä»–æ•°æ®æºé€‚é…å™¨ï¼Œå¹¶æ›´æ–°ä¸šåŠ¡ä»£ç ä½¿ç”¨æ–°æ¶æ„ã€‚

ğŸš€ **é¡¹ç›®å·²ç»å…·å¤‡äº†æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼**
